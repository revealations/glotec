/*!
    *
    * Wijmo Library 5.20212.812
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(e,o){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var l in o)o.hasOwnProperty(l)&&(e[l]=o[l])})(e,o)};return function(e,o){extendStatics(e,o);function __(){this.constructor=e}e.prototype=null===o?Object.create(o):(__.prototype=o.prototype,new __)}}(),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var l in e)Object.hasOwnProperty.call(e,l)&&(o[l]=e[l]);o.default=e;return o};Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),mXlsx=__importStar(require("wijmo/wijmo.xlsx")),selfModule=__importStar(require("wijmo/wijmo.grid.xlsx"));function softDetail(){return wijmo_1._getModule("wijmo.grid.detail")}exports.softDetail=softDetail;function softMultiRow(){return wijmo_1._getModule("wijmo.grid.multirow")}exports.softMultiRow=softMultiRow;function softTransposed(){return wijmo_1._getModule("wijmo.grid.transposed")}exports.softTransposed=softTransposed;function softTransposedMultiRow(){return wijmo_1._getModule("wijmo.grid.transposedmultirow")}exports.softTransposedMultiRow=softTransposedMultiRow;var FlexGridXlsxConverter=function(){function FlexGridXlsxConverter(){}FlexGridXlsxConverter.save=function(e,o,l){var t=new mXlsx.Workbook;this._saveFlexGridToWorkbook(t,e,o,!1,null);l&&t.save(l);return t};FlexGridXlsxConverter.saveAsync=function(e,o,l,t,r,n,i){var s=this,a=new mXlsx.Workbook;if(!i){this._saveFlexGridToWorkbook(a,e,o,!1,null);l?a.saveAsync(l,(function(e){wijmo_1.isFunction(t)&&t(e,a)}),r,null):wijmo_1.isFunction(t)&&t(null,a);return a}var u=null!=l;this.cancelAsync((function(){var i,d=[e.collectionView&&e.collectionView.collectionChanged,e.columns&&e.columns.collectionChanged,e.rows&&e.rows.collectionChanged,e.resizedColumn,e.resizedRow],removeHandlers=function(){return d.forEach((function(e){e&&e.removeHandler(restart)}))},restart=function(){s._cs&&s._cs.cancel(!1);clearTimeout(i);i=setTimeout((function(){removeHandlers();a=null;s.saveAsync(e,o,l,t,r,n)}),100)},finish=function(){clearTimeout(i);s._cs=null;removeHandlers()};s._cs=new mXlsx._SyncPromise(null,finish);d.forEach((function(e){e&&e.addHandler(restart)}));s._saveFlexGridToWorkbook(a,e,o,!0,s._cs,(function(e){wijmo_1.isFunction(n)&&n(u?Math.round(mXlsx._map(e,0,100,0,50)):e)})).then((function(){if(l){a._externalCancellation=function(){return s._cs};a.saveAsync(l,(function(e){finish();wijmo_1.isFunction(t)&&t(e,a)}),(function(e){finish();wijmo_1.isFunction(r)&&r(e)}),(function(e){wijmo_1.isFunction(n)&&n(Math.round(mXlsx._map(e,0,100,51,100)))}))}else{finish();wijmo_1.isFunction(n)&&n(100);wijmo_1.isFunction(t)&&t(null,a)}}),(function(e){finish();throw e}))}));return null};FlexGridXlsxConverter.cancelAsync=function(e){var o=this;if(this._cs){this._cs.cancel();setTimeout((function(){o._cs=null;wijmo_1.isFunction(e)&&e()}),100)}else wijmo_1.isFunction(e)&&e()};FlexGridXlsxConverter.load=function(e,o,l){var t=this;if(o instanceof Blob)_blobToBuffer(o,(function(r){o=null;var n=new mXlsx.Workbook;n.load(r);r=null;e.deferUpdate((function(){t._loadToFlexGrid(e,n,l);n=null}))}));else if(o instanceof mXlsx.Workbook)e.deferUpdate((function(){t._loadToFlexGrid(e,o,l);o=null}));else{if(!(o instanceof ArrayBuffer||wijmo_1.isString(o)))throw"Invalid workbook.";var r=new mXlsx.Workbook;r.load(o);o=null;e.deferUpdate((function(){t._loadToFlexGrid(e,r,l);r=null}))}};FlexGridXlsxConverter.loadAsync=function(e,o,l,t,r){var n=this;if(o instanceof Blob)_blobToBuffer(o,(function(i){o=null;var s=new mXlsx.Workbook;s.loadAsync(i,(function(){i=null;e.deferUpdate((function(){n._loadToFlexGrid(e,s,l);t&&t(s);s=null}))}),r)}));else if(o instanceof mXlsx.Workbook)e.deferUpdate((function(){n._loadToFlexGrid(e,o,l);t&&t(o);o=null}));else{if(!(o instanceof ArrayBuffer||wijmo_1.isString(o)))throw"Invalid workbook.";var i=new mXlsx.Workbook;i.loadAsync(o,(function(){o=null;e.deferUpdate((function(){n._loadToFlexGrid(e,i,l);t&&t(i);i=null}))}),r)}};FlexGridXlsxConverter._saveFlexGridToWorkbook=function(e,o,l,t,r,n){var i=new mXlsx._SyncPromise(r),s=new mXlsx.WorkSheet,a=!l||null==l.includeColumnHeaders||l.includeColumnHeaders,u=!(!l||null==l.includeRowHeaders)&&l.includeRowHeaders,d=_IncludeCellStyles.Cache,c=l?l.includeColumns:null,f=l?l.formatItem:null,m=[];l&&(d=!1===wijmo_1.asBoolean(l.includeCellStyles,!0)?_IncludeCellStyles.None:!1===wijmo_1.asBoolean(l.quickCellStyles,!0)?_IncludeCellStyles.Regular:_IncludeCellStyles.Cache);var h=d===_IncludeCellStyles.Cache?new _StyleCache(500):null;null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style);var _,p=o.wj_sheetInfo;s.name=l?l.sheetName:"";s.visible=!l||!1!==l.sheetVisible;if(p&&p.tables&&p.tables.length>0)for(var w=0;w<p.tables.length;w++)s.tables.push(p.tables[w]);if(!p&&(d!==_IncludeCellStyles.None||f)){(_=document.createElement("div")).style.visibility="hidden";_.setAttribute(wijmo_grid_1.FlexGrid._WJS_MEASURE,"true");o.hostElement.appendChild(_)}var x=u?o.rowHeaders.columns.length:0,g=this._getPerRowColumnsSettings(o,u?[o.topLeftCells,o.columnHeaders]:[o.columnHeaders]),v=g.cols,C=softMultiRow()&&o instanceof softMultiRow().MultiRow?this._getPerRowColumnsSettings(o,u?[o.rowHeaders,o.cells]:[o.cells],o.rowsPerItem).cols:null,y=v.length,b=[[o.topLeftCells,o.columnHeaders],[o.rowHeaders,o.cells],[o.bottomLeftCells,o.columnFooters]];a||b.shift();var S=b.map((function(e){return e[1].rows.length})).reduce((function(e,o){return e+o}));v.length&&v[0].forEach((function(e,o){var l=g.bndCols[0][o];if(!(o>=x&&c)||c(l)){var t=new mXlsx.WorkbookColumn;t._deserialize(e);s._addWorkbookColumn(t)}}));this._saveContentToWorksheet(r,t,Date.now(),0,{panels:b,panelIdx:0,globRowIdx:0,rowsOffset:0,totalRows:S},o,s,u,(function(e){return e==wijmo_grid_1.CellType.Cell&&C?C:v}),d,_,m,h,c,f,(function(e){n(Math.round(e/S*100))}),(function(){var t=new mXlsx.WorkbookFrozenPane;t.rows=a?o.frozenRows+y:o.frozenRows;t.columns=u?o.frozenColumns+x:o.frozenColumns;s.frozenPane=t;e._addWorkSheet(s);if(!p&&(d!==_IncludeCellStyles.None||f)){o.hostElement.removeChild(_);m.forEach((function(e){return e.forEach((function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}))}))}h&&h.clear();e.activeWorksheet=l?l.activeWorksheet:null;i.resolve()}));return i};FlexGridXlsxConverter._saveContentToWorksheet=function(e,o,l,t,r,n,i,s,a,u,d,c,f,m,h,_,p){for(var w=this,x=u?20:200,_loop_1=function(v){if(e&&e.cancelled)return{value:void 0};if(o&&v-t>x&&Date.now()-l>100){setTimeout((function(){if(!e||!e.cancelled){_(v);w._saveContentToWorksheet(e,o,Date.now(),v,r,n,i,s,a,u,d,c,f,m,h,_,p)}}),0);return{value:void 0}}for(;v-r.rowsOffset>=r.panels[r.panelIdx][1].rows.length;){r.rowsOffset+=r.panels[r.panelIdx][1].rows.length;r.panelIdx++}var C=r.panels[r.panelIdx],y=C[0],b=C[1],S=v-r.rowsOffset,T=b.rows[S];if(b.cellType!==wijmo_grid_1.CellType.Cell&&T.renderSize<=0||T instanceof wijmo_grid_1._NewRowTemplate)return"continue";var X=0,F={},j=new mXlsx.WorkbookRow,k=T instanceof wijmo_grid_1.GroupRow,R=0;b.cellType===wijmo_grid_1.CellType.Cell&&(k?R=T.level:n.rows.maxGroupLevel>-1&&(R=n.rows.maxGroupLevel+1));var G=a(b.cellType);s&&(X=g._parseFlexGridRowToSheetRow(y,F,S,0,G,u,d,c,f,k,R,m,h));g._parseFlexGridRowToSheetRow(b,F,S,X,G,u,d,c,f,k,R,m,h);if(F.cells.length>0){j._deserialize(F);i._addWorkbookRow(j,r.globRowIdx)}r.globRowIdx++},g=this,v=t;v<r.totalRows;v++){var C=_loop_1(v);if("object"==typeof C)return C.value}wijmo_1.isFunction(p)&&p()};FlexGridXlsxConverter._loadToFlexGrid=function(e,o,l){if(softTransposedMultiRow()&&e instanceof softTransposedMultiRow().TransposedMultiRow)throw"Not supported.";l=l||{};var t,r=null!=e.wj_sheetInfo,n={},i=[],s=[],a={};e.itemsSource=null;e.columns.clear();e.columnHeaders.rows.clear();e.rows.clear();e.frozenColumns=0;e.frozenRows=0;var u=null==l.sheetIndex||isNaN(l.sheetIndex)?0:l.sheetIndex;if(u<0||u>=o.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=l.sheetName)for(var d=0;d<o.sheets.length;d++)if(l.sheetName===o.sheets[d].name){t=o.sheets[d];break}if(null!=(t=t||o.sheets[u]).rows){for(var c=this._getColumnCount(t.rows),f=this._getRowCount(t.rows,c),m=t.columns,h=0;h<c;h++){e.columns.push(new wijmo_grid_1.Column);if(m[h]){isNaN(+m[h].width)||(e.columns[h].width=+m[h].width);m[h].visible||null==m[h].visible||(e.columns[h].visible=!!m[h].visible);m[h].style&&m[h].style.wordWrap&&(e.columns[h].wordWrap=m[h].style.wordWrap)}}var _,p=(null==l.includeColumnHeaders||l.includeColumnHeaders)&&t.rows.length>0,w=p?this._getColumnHeadersHeight(t):0,x=!1,g=[],v=t.frozenPane&&t.frozenPane.rows,C=t.frozenPane&&t.frozenPane.columns;v=wijmo_1.isNumber(v)&&!isNaN(v)?v:null;C=wijmo_1.isNumber(C)&&!isNaN(C)?C:null;for(var y=w;y<f;y++){var b=!1,S=null,T=t.rows[y];if(T)for(var X=y+1;X<t.rows.length;){var F=t.rows[X];if(F){(isNaN(T.groupLevel)&&!isNaN(F.groupLevel)||!isNaN(T.groupLevel)&&T.groupLevel<F.groupLevel)&&(b=!0);break}X++}if(b&&!t.summaryBelow){_&&(_.isCollapsed=x);(_=new wijmo_grid_1.GroupRow).isReadOnly=!1;x=null!=T.collapsed&&T.collapsed;_.level=isNaN(T.groupLevel)?0:T.groupLevel;a[_.level]=x;this._checkParentCollapsed(a,_.level)&&_._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0);e.rows.push(_)}else{var j=new wijmo_grid_1.Row;T&&this._checkParentCollapsed(a,T.groupLevel)&&j._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0);e.rows.push(j)}T&&T.height&&!isNaN(T.height)&&(e.rows[y-w].height=T.height);for(h=0;h<c;h++)if(T){var k=T.cells[h],R=k?k.formula:null;R&&"="!==R[0]&&(R="="+R);if(k&&k.textRuns&&k.textRuns.length>0){e.rows[y-w].isContentHtml=!0;e.setCellData(y-w,h,this._parseTextRunsToHTML(k.textRuns))}else e.setCellData(y-w,h,R&&r?R:this._getItemValue(k));b||this._setColumn(g,h,k);var G=y*c+h,W=k?k.style:null;if(W){S=null==S?!!W.wordWrap:S&&!!W.wordWrap;if(r){var I=mXlsx.Workbook._parseExcelFormat(k),A=void 0;if(W.hAlign)A=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(W.hAlign,mXlsx.HAlign));else switch(this._getItemType(k)){case wijmo_1.DataType.Number:A="right";break;case wijmo_1.DataType.Boolean:A="center";break;default:A=I&&0===I.search(/[n,c,p]/i)?"right":"left"}n[G]={fontWeight:W.font&&W.font.bold?"bold":"none",fontStyle:W.font&&W.font.italic?"italic":"none",textDecoration:W.font&&W.font.underline?"underline":"none",textAlign:A,fontFamily:W.font&&W.font.family?W.font.family:"",fontSize:W.font&&W.font.size?W.font.size+"px":"",color:W.font&&W.font.color?W.font.color:"",backgroundColor:W.fill&&W.fill.color?W.fill.color:"",whiteSpace:W.wordWrap?"pre-wrap":"normal",format:I};if(W.borders){if(W.borders.left){this._parseBorderStyle(W.borders.left.style,"Left",n[G]);n[G].borderLeftColor=W.borders.left.color}if(W.borders.right){this._parseBorderStyle(W.borders.right.style,"Right",n[G]);n[G].borderRightColor=W.borders.right.color}if(W.borders.top){this._parseBorderStyle(W.borders.top.style,"Top",n[G]);n[G].borderTopColor=W.borders.top.color}if(W.borders.bottom){this._parseBorderStyle(W.borders.bottom.style,"Bottom",n[G]);n[G].borderBottomColor=W.borders.bottom.color}}if(W.fill&&W.fill.color){var B=n[G],M=W.borders,D=W.fill.color;if(M){M.left&&M.left.color||(B.borderLeftColor=D);M.right&&M.right.color||h===C-1||(B.borderRightColor=D);M.top&&M.top.color||(B.borderTopColor=D);M.bottom&&M.bottom.color||y===v-1||(B.borderBottomColor=D)}else{B.borderLeftColor=D;h!==C-1&&(B.borderRightColor=D);B.borderTopColor=D;y!==v-1&&(B.borderBottomColor=D)}}W.font&&-1===s.indexOf(W.font.family)&&s.push(W.font.family)}}r&&k&&wijmo_1.isNumber(k.rowSpan)&&k.rowSpan>0&&wijmo_1.isNumber(k.colSpan)&&k.colSpan>0&&(k.rowSpan>1||k.colSpan>1)&&i.push(new wijmo_grid_1.CellRange(y,h,y+k.rowSpan-1,h+k.colSpan-1))}if(T){this._checkParentCollapsed(a,T.groupLevel)||T.visible||null==T.visible||(e.rows[y-w].visible=T.visible);e.rows[y-w].wordWrap=!!T.style&&!!T.style.wordWrap||!!S}}_&&(_.isCollapsed=x);null!=C&&(e.frozenColumns=C);null!=v&&(e.frozenRows=p&&v>0?v-1:v);for(h=0;h<e.columnHeaders.columns.length;h++){var N=g[h],E=e.columns[h];E.isRequired=!1;if(N){N.dataType===wijmo_1.DataType.Boolean&&(E.dataType=N.dataType);E.format=N.format;E.align=N.hAlign;E.wordWrap=E.wordWrap||!!N.wordWrap}}for(d=0;d<Math.max(w,1);d++)e.columnHeaders.rows.push(new wijmo_grid_1.Row);for(d=0;d<w;d++)for(var H=0;H<e.columnHeaders.columns.length;H++){var z=t.rows[d]?t.rows[d].cells[H]:null,O=z&&null!=z.value?z.value:"",L=e.columnHeaders.columns[H];if(O){var P=mXlsx.Workbook._parseExcelFormat(z);O=wijmo_1.Globalize.format(O,P)}L.header=L.header||O;e.columnHeaders.setCellData(d,H,O)}if(r){var V=null==l.sheetVisible||l.sheetVisible;e.wj_sheetInfo.name=t.name;e.wj_sheetInfo.visible=!0===V||!1!==t.visible;e.wj_sheetInfo.styledCells=n;e.wj_sheetInfo.mergedRanges=i;e.wj_sheetInfo.fonts=s;e.wj_sheetInfo.tables=t.tables}}};FlexGridXlsxConverter._getColumnHeadersHeight=function(e){var o;if(!e||!(o=e.rows).length)return 0;if(!o[0])return 1;for(var l=0,t=1;l<o.length&&t>0;l++,t--){var r=o[l].cells.reduce((function(e,o){return Math.max(e,o.rowSpan||0)}),1);r>t&&(t=r)}return l};FlexGridXlsxConverter._escapePlainText=function(e){return null==e?"":""===e?"'":e&&("'"===e[0]||e.length>1&&"="===e[0]&&"="===e[1])?"'"+e:e};FlexGridXlsxConverter._parseFlexGridRowToSheetRow=function(e,o,l,t,r,n,i,s,a,u,d,c,f){var m=e.grid,h=m.wj_sheetInfo,_=e.rows[l],p=0,w=h&&h.evaluateFormula;null==_.recordIndex?e.cellType===wijmo_grid_1.CellType.ColumnHeader&&e.rows.length>1&&(p=Math.min(l,r.length-1)):p=_.recordIndex;o.cells||(o.cells=[]);o.visible=_.isVisible;o.height=_.renderHeight||e.rows.defaultSize;o.groupLevel=d;u&&(o.collapsed=_.isCollapsed);_.wordWrap&&(o.style={wordWrap:_.wordWrap});for(var x,g=_.constructor===wijmo_grid_1.Row||_.constructor===wijmo_grid_1._NewRowTemplate||softTransposed()&&m instanceof softTransposed().TransposedGrid&&_ instanceof wijmo_grid_1.Row||softDetail()&&_.constructor===softDetail().DetailRow||softMultiRow()&&_.constructor===softMultiRow()._MultiRow||softTransposedMultiRow()&&_ instanceof softTransposedMultiRow()._MultiRow,v=softDetail()&&_.constructor===softDetail().DetailRow,C=0;C<e.columns.length;C++){var y=void 0,b=void 0,S=void 0,T=1,X=1,F=!1,j=m._getBindingColumn(e,l,e.columns[C]),k=0;if(h&&e===m.cells){var R=l*e.columns.length+C;h.mergedRanges&&(y=this._getMergedRange(l,C,h.mergedRanges));h.styledCells&&(b=h.styledCells[R])}else if(n!==_IncludeCellStyles.None){S=this._getMeasureCell(e,C,i,s);b=(y=m.getMergedRange(e,l,C,!1))?this._getCellStyle(e,S,y.bottomRow,y.rightCol,a,!!f)||{}:this._getCellStyle(e,S,l,C,a,!!f)||{}}y||(y=m.getMergedRange(e,l,C,!1));if(y){if(l===y.topRow&&C===y.leftCol){X=y.bottomRow-y.topRow+1;T=this._getColSpan(e,y,c);F=!0}}else F=!0;if(!c||c(j)){var G=r[p]?r[p][C+t]:null,W=void 0,I=void 0,A=void 0,B=void 0,M=void 0,D=void 0,N=void 0;if(g||u){A=F?e.getCellData(l,C,!0):null;B=F?e.getCellData(l,C,!1):null;I=this._isFormula(A);W=null;M=wijmo_1.isDate(B);if(b&&b.format){D=b.format;/[hsmyt\:]/i.test(D)&&(M=!0);N=mXlsx.Workbook._parseCellFormat(b.format,M)}else if(G&&G.style&&G.style.format){D=j.format;N=G.style.format}else N=null;I&&null!=w&&wijmo_1.isFunction(w)&&(W=w(A));if(!N)if(M)N="m/d/yyyy";else if(wijmo_1.isNumber(B)&&!j.dataMap)N=wijmo_1.isInt(B)?"#,##0":"#,##0.00";else if(I){var E=A.toLowerCase();if(E.indexOf("now()")>-1){N="m/d/yyyy h:mm";M=!0}else if(E.indexOf("today()")>-1||E.indexOf("date(")>-1){N="m/d/yyyy";M=!0}else if(E.indexOf("time(")>-1){N="h:mm AM/PM";M=!0}}else N="General"}else{A=F?m.columnHeaders.getCellData(0,C,!0):null;N="General"}var H=void 0;if(wijmo_1.isString(A)&&-1!==A.indexOf("<span")){H=this._parseToTextRuns(A);A=null}var z=this._parseCellStyle(b)||{};if(e===m.cells&&u&&_.hasChildren&&C===m.columns.firstVisibleIndex){var O=void 0;if(I&&null!=W)O=W;else{A?O=A:F&&(O=_.getGroupHeader());O&&(O=O.replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'"))}if(null==O&&!b)continue;!(M=wijmo_1.isDate(O))&&D&&"d"===D.toLowerCase()&&wijmo_1.isInt(O)&&(N="0");O=wijmo_1.isString(O)?mXlsx.Workbook._unescapeXML(O):O;C===m.columns.firstVisibleIndex&&m.treeIndent&&(k=d);x={value:O,isDate:M,formula:I?this._parseToExcelFormula(A,M):null,colSpan:T,rowSpan:X,style:this._extend(z,{format:N,font:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:k}),textRuns:H}}else{A=wijmo_1.isString(A)?mXlsx.Workbook._unescapeXML(A):A;B=wijmo_1.isString(B)?mXlsx.Workbook._unescapeXML(B):B;!M&&D&&"d"===D.toLowerCase()&&wijmo_1.isInt(B)&&(N="0");var L=void 0;L=z&&z.hAlign?z.hAlign:G&&G.style&&null!=G.style.hAlign?wijmo_1.asEnum(G.style.hAlign,mXlsx.HAlign,!0):wijmo_1.isDate(B)?mXlsx.HAlign.Left:mXlsx.HAlign.General;C!==m.columns.firstVisibleIndex||!m.treeIndent||L!==mXlsx.HAlign.Left&&L!==mXlsx.HAlign.General||(k=d);x={value:I?W:"General"!==N||""===A&&null==B?this._escapePlainText(B):this._escapePlainText(A),isDate:M,formula:I?this._parseToExcelFormula(A,M):null,colSpan:C<m.columns.firstVisibleIndex?1:T,rowSpan:X,style:this._extend(z,{format:N,hAlign:L,vAlign:X>1?e===m.cells||!1===m.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:k}),textRuns:H}}if(f){f(new XlsxFormatItemEventArgs(e,new wijmo_grid_1.CellRange(l,C),S,i,s,a,x))}if(v){var P=e.getCellElement(l,C);if(P){var V=_.detail;P.appendChild(V);wijmo_1.Control.refreshAll(V)}}o.cells.push(x)}}return t+C};FlexGridXlsxConverter._parseCellStyle=function(e,o){void 0===o&&(o=!1);if(null==e)return null;var l=e.fontSize;l=l?+l.substring(0,l.indexOf("px")):null;isNaN(l)&&(l=null);var t=e.whiteSpace;t=!!t&&t.indexOf("pre")>-1;var r=e.textAlign;"start"===r&&(r="rtl"===e.direction?"right":"left");"end"===r&&(r="rtl"===e.direction?"left":"right");return{font:{bold:"bold"===e.fontWeight||+e.fontWeight>=700,italic:"italic"===e.fontStyle,underline:"underline"===(e.textDecorationStyle||e.textDecoration),family:this._parseToExcelFontFamily(e.fontFamily),size:l,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,o),hAlign:mXlsx.Workbook._parseStringToHAlign(r),wordWrap:t}};FlexGridXlsxConverter._parseBorder=function(e,o){var l={left:this._parseEgdeBorder(e,"Left"),right:this._parseEgdeBorder(e,"Right"),top:this._parseEgdeBorder(e,"Top"),bottom:this._parseEgdeBorder(e,"Bottom")};if(o){l.vertical=this._parseEgdeBorder(e,"Vertical");l.horizontal=this._parseEgdeBorder(e,"Horizontal")}return l};FlexGridXlsxConverter._parseEgdeBorder=function(e,o){var l,t=e["border"+o+"Style"],r=e["border"+o+"Width"];r&&(r=parseFloat(r));if(t&&"none"!==t&&"hidden"!==t&&0!==r){l={};switch(t=t.toLowerCase()){case"dotted":l.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":l.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":l.style=mXlsx.BorderStyle.Double;break;default:l.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}l.color=e["border"+o+"Color"]}return l};FlexGridXlsxConverter._parseBorderStyle=function(e,o,l){var t="border"+o+"Style",r="border"+o+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:l[t]="dotted";l[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:l[t]="dashed";l[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:l[t]="dashed";l[r]="2px";break;case mXlsx.BorderStyle.Double:l[t]="double";l[r]="3px";break;case mXlsx.BorderStyle.Medium:l[t]="solid";l[r]="2px";break;case mXlsx.BorderStyle.Thick:l[t]="solid";l[r]="3px";break;default:l[t]="solid";l[r]="1px"}};FlexGridXlsxConverter._parseToExcelFontFamily=function(e){var o;e&&(o=e.split(","))&&o.length>0&&(e=o[0].replace(/\"|\'/g,""));return e};FlexGridXlsxConverter._parseToExcelFormula=function(e,o){var l=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi);if(l)for(var t=0;t<l.length;t++){var r=(i=l[t]).substring(0,i.lastIndexOf(")"))+", 1)";e=e.replace(i,r)}l=null;if(l=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi)){var n=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;for(t=0;t<l.length;t++){var i,s=(i=l[t]).match(n);if(s&&2===s.length){var a=s[1];if(!/^d{1,4}?$/.test(a)){var u=mXlsx.Workbook._parseCellFormat(a,o);r=i.replace(a,u);e=e.replace(i,r)}}}}return e};FlexGridXlsxConverter._parseToTextRuns=function(e){for(var o=e.split("<span "),l=[],t=0;t<o.length;t++){var r=o[t],n=void 0;if(-1!==r.indexOf("</span>")){n={text:r.substring(r.indexOf(">")+1,r.indexOf("</span>")),font:this._parseToTextRunFont(r.substring(r.indexOf('style="')+7,r.indexOf(';"')))}}else n={text:r};l.push(n)}return l};FlexGridXlsxConverter._parseToTextRunFont=function(e){var o,l=e.split(";");if(l.length>0){for(var t=void 0,r=void 0,n=void 0,i=void 0,s=void 0,a=void 0,u=0;u<l.length;u++){var d=l[u].split(":");if(2===d.length){d[1]=d[1].trim();switch(d[0]){case"font-size":i=+d[1].substring(0,d[1].indexOf("px"));isNaN(i)&&(i=null);break;case"font-weight":t="bold"===d[1]||+d[1]>=700;break;case"font-style":r="italic"===d[1];break;case"text-decoration-style":case"text-decoration":n="underline"===d[1];break;case"font-family":s=this._parseToExcelFontFamily(d[1]);break;case"color":a=d[1]}}}o={bold:t,italic:r,underline:n,family:s,size:i,color:a}}return o};FlexGridXlsxConverter._getMeasureCell=function(e,o,l,t){var r=t[e.cellType],n=r&&r[o],i=null==n;if(n){if(this.hasCssText){n.style.cssText="";n.style.visibility="hidden"}}else{r||(t[e.cellType]=r=[]);r[o]=n=l.cloneNode()}!i&&n.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(n):e.hostElement.appendChild(n));return n};FlexGridXlsxConverter._getColumnSetting=function(e,o,l){var t=e;null!=e.colspan&&(t=this._getRenderColumn(o,l));return t?{autoWidth:!0,width:t.renderWidth||l.defaultSize,visible:t.visible&&0!==t.width&&!t._getFlag(wijmo_grid_1.RowColFlags.ParentCollapsed),style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===wijmo_1.DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(t.getAlignment())),wordWrap:t.wordWrap}}:null};FlexGridXlsxConverter._getPerRowColumnsSettings=function(e,o,l){var t=this,r=[],n=[];o.forEach((function(i,s){for(var a=0,u=s>0?o[0].columns.length:0,_loop_2=function(o){if(null!=l&&o>=l)return"break";if(i.rows[o].renderSize<=0)return"continue";r[a]=r[a]||[];n[a]=n[a]||[];i.columns.forEach((function(l,s){var d=e._getBindingColumn(i,o,l),c=t._getColumnSetting(d,s,i.columns);if(c){r[a][u+s]=c;n[a][u+s]=d}}));a++},d=0;d<i.rows.length;d++){if("break"===_loop_2(d))break}}));return{cols:r,bndCols:n}};FlexGridXlsxConverter._toExcelHAlign=function(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e};FlexGridXlsxConverter._getColumnCount=function(e){for(var o=0,l=0;l<e.length;l++){var t=e[l]&&e[l].cells?e[l].cells:[];if(t&&t.length>0){var r=t.length;wijmo_1.isInt(t[r-1].colSpan)&&t[r-1].colSpan>1&&(r=r+t[r-1].colSpan-1);r>o&&(o=r)}}return o};FlexGridXlsxConverter._getRowCount=function(e,o){for(var l=e.length,t=l-1,r=0;r<o;r++)e:for(;t>=0;t--){var n=e[t],i=(n&&n.cells?n.cells:[])[r];if(i&&(null!=i.value&&""!==i.value||wijmo_1.isInt(i.rowSpan)&&i.rowSpan>1)){wijmo_1.isInt(i.rowSpan)&&i.rowSpan>1&&t+i.rowSpan>l&&(l=t+i.rowSpan);break e}}return l};FlexGridXlsxConverter._numAlpha=function(e){var o=Math.floor(e/26)-1;return(o>-1?this._numAlpha(o):"")+String.fromCharCode(65+e%26)};FlexGridXlsxConverter._getItemType=function(e){return null==e||null==e.value||isNaN(e.value)?null:wijmo_1.getType(e.value)};FlexGridXlsxConverter._setColumn=function(e,o,l){var t=e[o];if(t){var r=this._getItemType(l);t.dataType!==r&&t.dataType===wijmo_1.DataType.Boolean&&r!==wijmo_1.DataType.Boolean&&(t.dataType=r);if(l&&null!=l.value&&(!wijmo_1.isString(l.value)||!wijmo_1.isNullOrWhiteSpace(l.value))){var n=mXlsx.Workbook._parseExcelFormat(l);n&&t.format!==n&&"General"!==n&&(t.format=n)}var i=void 0;if(l&&l.style){l.style.hAlign&&(i=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(l.style.hAlign,mXlsx.HAlign)));null==t.wordWrap?t.wordWrap=!!l.style.wordWrap:t.wordWrap=t.wordWrap&&!!l.style.wordWrap}i||r!==wijmo_1.DataType.Number||(i="right");t.hAlign=i}else e[o]={dataType:this._getItemType(l),format:mXlsx.Workbook._parseExcelFormat(l),hAlign:"",wordWrap:null}};FlexGridXlsxConverter._getItemValue=function(e){if(null==e||null==e.value)return null;var o=e.value;wijmo_1.isString(o)&&"'"===o[0]&&(o=o.substr(1));return wijmo_1.isNumber(o)&&isNaN(o)?"":o instanceof Date&&isNaN(o.getTime())?"":o};FlexGridXlsxConverter._getCellStyle=function(e,o,l,t,r,n){var i,s=e.grid;try{var a=!(r&&!s.formatItem.hasHandlers&&!s.itemFormatter&&!n);s.cellFactory.updateCell(e,l,t,o,null,a);o.className=o.className.replace("wj-state-selected","");o.className=o.className.replace("wj-state-multi-selected","")}catch(e){return null}if(r){var u=e.hostElement,d=o,c=d.style.cssText.split(/;\s+/).filter((function(e){var o=e.substring(0,e.indexOf(":"));return/^(color|background|border|font|text|whitespace)/i.test(o)})).join(";");do{c=d.className+c}while(d!==u&&(d=d.parentElement));if(!(i=r.getValue(c))){i=window.getComputedStyle(o);r.add(c,i)}}else i=window.getComputedStyle(o);return i};FlexGridXlsxConverter._parseTextRunsToHTML=function(e){for(var o="",l=0;l<e.length;l++){var t=e[l],r=t.font;o+=r?'<span style="'+(r.bold?"font-weight: bold;":"")+(r.italic?"font-style: italic;":"")+(r.underline?"text-decoration: underline;":"")+(r.family?"font-family: "+r.family+";":"")+(null!=r.size?"font-size: "+r.size+"px;":"")+(r.color?"color: "+r.color+";":"")+'">'+t.text+"</span>":t.text}return o};FlexGridXlsxConverter._extend=function(e,o){for(var l in o){var t=o[l];wijmo_1.isObject(t)&&e[l]?wijmo_1.copy(e[l],t):e[l]=t}return e};FlexGridXlsxConverter._checkParentCollapsed=function(e,o){var l=!1;Object.keys(e).forEach((function(t){!0===e[t]&&!1===l&&!isNaN(o)&&+t<o&&(l=!0)}));return l};FlexGridXlsxConverter._getColSpan=function(e,o,l){for(var t=0,r=o.leftCol;r<=o.rightCol;r++)l&&!l(e.columns[r])||t++;return t};FlexGridXlsxConverter._getRenderColumn=function(e,o){return e>=o.length?null:o[e]};FlexGridXlsxConverter._getMergedRange=function(e,o,l){for(var t=0;t<l.length;t++){var r=l[t];if(e>=r.topRow&&e<=r.bottomRow&&o>=r.leftCol&&o<=r.rightCol)return r}return null};FlexGridXlsxConverter._isFormula=function(e){return e&&"string"==typeof e&&e.length>1&&"="===e[0]&&"="!==e[1]};return FlexGridXlsxConverter}();exports.FlexGridXlsxConverter=FlexGridXlsxConverter;var _IncludeCellStyles,XlsxFormatItemEventArgs=function(e){__extends(XlsxFormatItemEventArgs,e);function XlsxFormatItemEventArgs(o,l,t,r,n,i,s){var a=e.call(this,o,l)||this;a._cell=t;a._patternCell=r;a._xlsxCell=s;a._cellsCache=n;a._styleCache=i;return a}Object.defineProperty(XlsxFormatItemEventArgs.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0});Object.defineProperty(XlsxFormatItemEventArgs.prototype,"xlsxCell",{get:function(){return this._xlsxCell},set:function(e){this._xlsxCell=e},enumerable:!0,configurable:!0});XlsxFormatItemEventArgs.prototype.getFormattedCell=function(){if(!this._cell){this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache);FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col,this._styleCache,!0)}return this._cell};return XlsxFormatItemEventArgs}(wijmo_grid_1.CellRangeEventArgs);exports.XlsxFormatItemEventArgs=XlsxFormatItemEventArgs;!function(e){e[e.None=0]="None";e[e.Regular=1]="Regular";e[e.Cache=2]="Cache"}(_IncludeCellStyles||(_IncludeCellStyles={}));var _StyleCache=function(){function _StyleCache(e){this._cache={};this._size=0;this._max=e}_StyleCache.prototype.add=function(e,o){this._size>=this._max&&this.clear();this._cache[e]=this._cloneStyle(o);this._size++};_StyleCache.prototype.clear=function(){this._cache={};this._size=0};_StyleCache.prototype.getValue=function(e){return this._cache[e]||null};_StyleCache.prototype.hasKey=function(e){return!!this._cache[e]};_StyleCache.prototype._cloneStyle=function(e){if(!e)return null;for(var o={},toCamel=function(e){return e.replace(/\-([a-z])/g,(function(e,o,l){return l>0?o.toUpperCase():o}))},l=0,t=e.length;l<t;l++){var r=e[l];o[toCamel(r)]=e.getPropertyValue(r)}return o};return _StyleCache}();exports._StyleCache=_StyleCache;function _blobToBuffer(e,o){if(e&&o)if(e.arrayBuffer)e.arrayBuffer().then((function(e){return o(e)}));else{var l=new FileReader;l.onload=function(){o(l.result);l=null};l.readAsArrayBuffer(e)}}exports._blobToBuffer=_blobToBuffer;wijmo_1._registerModule("wijmo.grid.xlsx",selfModule);